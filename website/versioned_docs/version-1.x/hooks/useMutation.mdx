---
sidebar_position: 4
sidebar_label: useMutation()
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# useMutation()

The Hook enables you to perform asynchronous data mutation operations, such as _POST_, _PUT_, _PATCH_, or _DELETE_ requests.
It not only handles the loading state, but also provides an APIs for optimistic updates and error handling.
See the TanStack [_useMutation(...) ðŸŒ´_](https://tanstack.com/query/latest/docs/framework/react/reference/useMutation)
documentation for more details.

```ts
const query = qraft.<service>.<operation>.useMutation(
  parameters,
  mutationOptions,
  queryClient,
)
```

### Arguments

1.  `parameters?: { path, query, header }`
    - **Optional**, OpenAPI request parameters for the query, strictly-typed âœ¨
    - When `parameters` provided, it will be used to generate the `mutationKey`

2.  `mutationOptions?: UseMutationOptions`
    - **Optional**, represents the options of the [_useMutation(...) ðŸŒ´_](https://tanstack.com/query/latest/docs/framework/react/reference/useMutation) Hook
    - When `qraft.<srv>.<op>.useMutation(parameters)` is used (with the predefined _parameters_), `mutationKey` will contain the `parameters` and _operation schema_
    - When `qraft.<srv>.<op>.useMutation(undefined)` is used (without predefined _parameters_), `mutationKey` will contain just _operation schema_
    - `mutationOptions.mutationFn` could be provided to override the default `mutationFn` used by Qraft, strictly-typed âœ¨
    - `mutationOptions.mutationKey` could be provided to override the generated key from `parameters`, strictly-typed âœ¨

3.  `queryClient?: QueryClient`
    - **Optional** [_QueryClient ðŸŒ´_](https://tanstack.com/query/latest/docs/reference/QueryClient) to be used
    - _If not provided_
      - `QraftContext.queryClient` will be used if available
      - [_useQueryClient() ðŸŒ´_](https://tanstack.com/query/latest/docs/framework/react/reference/useQueryClient)
        result will be used as a fallback

### Returns
- `mutation: MutationResult`
  - **Object** from the [_useMutation(...) ðŸŒ´_](https://tanstack.com/query/latest/docs/framework/react/reference/useMutation) Hook
  - `mutation.mutate(parameters | {parameters, body})` initiates the request
  - `mutation.variables` will contain the `parameters` and `body` of the request,
    after calling `mutation.mutate(...)`.

### Examples

<Tabs>
  <TabItem value="with-known-parameters" label="With parameters ðŸ“–" default>
    When the `parameters` are known, the `useMutation` hook can be used with parameters
    to generate the `mutationKey`.

    - `mutation.mutate(...)` will accept the `body` of the request
    as the single argument.

    ```tsx title="src/EntityEditForm.tsx"
    import { createAPIClient } from './api'; // generated by OpenAPI Qraft

    const qraft = createAPIClient();

    function EntityEditForm({ entityId }: { entityId: string }) {
      const mutation = qraft.entities.entitiesIdDocuments.useMutation({
        path: {
          entity_id: entityId
        },
        header: {
          'x-monite-version': '2023-09-01',
        },
      });

      return (
        <form
          onSubmit={(event) => {
            event.preventDefault();
            const formData = new FormData(event.currentTarget);
            /**
             * `mutation.mutate(...)` triggers the submission of a request:
             * ###
             * POST /entities/3e3e-3e3e-3e3e/documents
             * x-monite-version: 2023-09-01
             *
             * {"company_tax_id_verification": ["verification-id"]}
             **/
            mutation.mutate({
              company_tax_id_verification: [
                `${formData.get('company_tax_id_verification')}`,
              ],
            });
          }}
        >
          <input name="company_tax_id_verification" />
          <button disabled={mutation.isPending}>Submit</button>
        </form>
      );
    }
    ```
  </TabItem>
  <TabItem value="without-known-parameters" label="No parameters ðŸ““">
    When the `parameters` are not known, the `useMutation` hook can be used without parameters.

    - `mutation.mutate(...)` will accept the object with `parameters` and `body` of the request as the single argument.

    ```tsx title="src/EntityForm.tsx"
    import { createAPIClient } from './api'; // generated by OpenAPI Qraft

    const qraft = createAPIClient();

    function EntityForm() {
      const mutation = qraft.entities.entitiesIdDocuments.useMutation();

      return (
        <form
          onSubmit={(event) => {
            event.preventDefault();
            const formData = new FormData(event.currentTarget);
            /**
             * `mutation.mutate(...)` triggers the submission of a request:
             * ###
             * POST /entities/3e3e-3e3e-3e3e/documents
             * x-monite-version: 2023-09-01
             *
             * {"company_tax_id_verification": ["verification-id"]}
             **/
            mutation.mutate({
              parameters: {
                path: {
                  entity_id: `${formData.get('entity_id')}`
                },
                header: {
                  'x-monite-version': '2023-09-01',
                },
              },
              body: {
                company_tax_id_verification: [
                  `${formData.get('company_tax_id_verification')}`,
                ],
              }
            });
          }}
        >
          <input name="entity_id" readOnly={mutation.isPending} />
          <input name="company_tax_id_verification" readOnly={mutation.isPending} />
          <button disabled={mutation.isPending}>Submit</button>
        </form>
      );
    }
    ```
  </TabItem>
</Tabs>
