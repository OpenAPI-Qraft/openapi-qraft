# @openapi-qraft/cli

`@openapi-qraft/cli` is a powerful command-line utility designed to streamline the development process by generating
service declarations and typed React Query interfaces directly from an OpenAPI Schema. With `@openapi-qraft/cli`,
frontend developers can easily generate typed API clients, ensuring type safety and improving development efficiency
within React applications.

## Features

- **Typed React Query Interfaces:** Create typed React Query hooks for seamless and type-safe API requests.
- **Generate Typed Services:** Automatically generate service declarations from an OpenAPI Schema.

## Installation

```bash
npm install -g @openapi-qraft/cli
```

## Usage

```
Usage: openapi-qraft [options] [input]

Arguments:
  input                                    Input OpenAPI Schema file path, URL (json, yml) (default: null)

Options:
  -o, --output-dir <path>                  Output directory for generated services
  --openapi-types-import-path <path>       Path to schema types file (.d.ts), eg: "../openapi.d.ts"
  -rm, --clean                             Clean output directory before generating services
  --filter-services <glob-pattern>          Filter services to be generated by glob pattern. Eg: "/user/**,/post/**". See NPM `micromatch` package for more details.
  --operation-generics-import-path <path>  Path to operation generics file (default: "@openapi-qraft/react")
  --file-header <string>                   Header to be added to the generated file (eg: /* eslint-disable */)
  --postfix-services <string>              Postfix to be added to the generated service name (eg: Service)
  --explicit-import-extensions             All import statements will include explicit `.js` extensions. Ideal for projects using ECMAScript modules.
  --service-name-base <endpoint | tags>    Use OpenAPI Operation `endpoint` or `tags` as service names (default: "endpoint")
  --plugin <name_1> --plugin <name_2>      Generator plugins to be used. (choices: "tanstack-query-react", "openapi-typescript")
  --no-blob-from-binary                    If this option is enabled, binary format fields will not be converted to Blob types, preserving the native
  -h, --help                               display help for command
```

## Usage example

The command below generates Qraft API services for the OpenAPI schema and places them in the `src/api` directory:

```bash npm2yarn
npx openapi-qraft --plugin tanstack-query-react --plugin openapi-typescript https://raw.githubusercontent.com/swagger-api/swagger-petstore/master/src/main/resources/openapi.yaml \
  --output-dir src/api
```

#### Required Options

- **`-o <path>, --output-dir <path>`:** Specify where to output the generated services.
  - Example: `--output-dir src/api`

#### Useful Options

- **`-rm, --clean`:** Clean the specified output directory services before generating to remove stale files _(optional)_.
- **`--filter-services`:** Filter services to be generated by glob pattern _(optional)_. See [`micromatch`](https://github.com/micromatch/micromatch)
  package for more details.
  - Examples:
    - `--filter-services '/user/**,/post/**'` - include only API endpoints that start with `/user/` or `/post/`
    - `--filter-services '**,!/internal/**'` - include _all_ API endpoints _except_ those that start with `/internal/`

#### Edge-case Options

- **`--service-name-base <endpoint[<index>] | tags>`:** Use OpenAPI Operation `endpoint[<index>]` path part (e.g.: `/0/1/2`) or `tags` as the base name of the service. _(optional, default: `endpoint[0]`)_.
  - Examples:
    - `--service-name-base endpoint[0]` generates `services/FooService.ts` for the endpoint `/foo/bar/baz`
    - `--service-name-base endpoint[1]` generates `services/BarService.ts` for the endpoint `/foo/bar/baz`
    - `--service-name-base endpoint[3]` generates `services/BazService.ts` for the endpoint `/foo/bar/baz` _(if the endpoint is shorter than the index, the last part is used)_
    - `--service-name-base tags` will generate services based on the OpenAPI Operation tags instead of the endpoint.
      - If multiple tags are present for the operation, similar services will be created for each tag. Operation with `tags: [Foo, Bar]` will generate `services/FooService.ts` and `services/BarService.ts`.
      - If there are no tags for the operation, the services will be created under the `default` tag. Operation with empty `tags: []` will generate `services/DefaultService.ts`.
- **`--explicit-import-extensions`:** Include explicit `.js` extensions in all import statements. Ideal for projects
- **`--file-header <string>`:** Add a custom header to each generated file, useful for disabling linting rules or adding file
  comments _(optional)_.
  - Example: `--file-header '/* eslint-disable */'`
- **`--postfix-services <string>`:** Customize the generated service names with a specific postfix _(optional, default: `Service`)_.
  - Example: `--postfix-services Endpoint` will generate `services/UserEndpoint.ts` instead of `services/UserService.ts`.
    using ECMAScript modules when TypeScript's _--moduleResolution_ is `node16` or `nodenext` _(optional)_.
- **`--plugin <name_1> --plugin <name_2>`**: Generator plugins to be used. (choices: `tanstack-query-react`, `openapi-typescript`)
- **`--openapi-types-import-path <path>`:** Set the path to the schema types definition file to ensure consistent type
  usage (assumed, you already have `schema.d.ts` as a result of the [`openapi-typescript`](https://github.com/drwpow/openapi-typescript) utility). You also probably
  don't need the ~~`--plugin openapi-typescript`~~ option in this case.
  - The path is the exact import specifier used in the _generated services_. It should be _relative_ to the service
    output directory.
    - Examples:
      - `--openapi-types-import-path ../openapi.d.ts`
      - `--openapi-types-import-path '@/api/openapi.d.ts'`
      - `--openapi-types-import-path '@external-package-types'`
- **`--operation-generics-import-path <path>`:** Define the path to the operation generics file, allowing for custom
  operation handling _(optional, default: `@openapi-qraft/react`)_.
- **`--no-blob-from-binary`**: If this option is enabled, `format: binary` fields will not be converted to Blob types, preserving the native
- **`-h, --help`:** Display help for the command (optional).

## Contributing

Contributions to `@openapi-qraft/cli` are welcome! Please feel free to submit issues, pull requests, or suggest features
to help improve the utility.

## License

This project is licensed under the [MIT License](https://opensource.org/license/mit/).
