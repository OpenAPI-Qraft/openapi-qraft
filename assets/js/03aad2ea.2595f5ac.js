"use strict";(globalThis.webpackChunkopenapi_qraft_website=globalThis.webpackChunkopenapi_qraft_website||[]).push([[2150],{1453:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"guides/directus-integration","title":"Directus Integration Guide","description":"This guide will walk you through integrating OpenAPI Qraft with Directus, a headless CMS platform.","source":"@site/docs/guides/directus-integration.mdx","sourceDirName":"guides","slug":"/guides/directus-integration","permalink":"/openapi-qraft/docs/guides/directus-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/OpenAPI-Qraft/openapi-qraft/edit/main/website/docs/guides/directus-integration.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"mainDocsSidebar","previous":{"title":"createAPIClient()","permalink":"/openapi-qraft/docs/codegen/create-api-client-function"},"next":{"title":"GET, HEAD, OPTIONS","permalink":"/openapi-qraft/docs/core/query-operation"}}');var i=r(2540),s=r(3023),a=r(8296),o=r(2491);const l={sidebar_position:1},c="Directus Integration Guide",d={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installing Required Packages",id:"installing-required-packages",level:3},{value:"Creating the Configuration",id:"creating-the-configuration",level:2},{value:"Configuration File Structure",id:"configuration-file-structure",level:3},{value:"Configuration Options Explained",id:"configuration-options-explained",level:3},{value:"Creating a Custom ParametersWrapper Type",id:"creating-a-custom-parameterswrapper-type",level:2},{value:"Type Definition",id:"type-definition",level:3},{value:"Understanding the Types",id:"understanding-the-types",level:3},{value:"How It Works",id:"how-it-works",level:3},{value:"Generating the API Client",id:"generating-the-api-client",level:2},{value:"Using Redocly Configuration",id:"using-redocly-configuration",level:3},{value:"Adding a Script to package.json",id:"adding-a-script-to-packagejson",level:3},{value:"Alternative: Using CLI Options Directly",id:"alternative-using-cli-options-directly",level:3},{value:"Creating a Custom requestFn for Directus",id:"creating-a-custom-requestfn-for-directus",level:2},{value:"Creating the requestFn File",id:"creating-the-requestfn-file",level:3},{value:"Why This Is Necessary",id:"why-this-is-necessary",level:3},{value:"Using the Generated Client in React",id:"using-the-generated-client-in-react",level:2},{value:"Key Features Demonstrated",id:"key-features-demonstrated",level:3},{value:"Additional Configuration",id:"additional-configuration",level:2},{value:"Obtaining the OpenAPI Specification",id:"obtaining-the-openapi-specification",level:3},{value:"Multiple APIs",id:"multiple-apis",level:3},{value:"Next Steps",id:"next-steps",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"directus-integration-guide",children:"Directus Integration Guide"})}),"\n",(0,i.jsxs)(n.p,{children:["This guide will walk you through integrating OpenAPI Qraft with ",(0,i.jsx)(n.a,{href:"https://directus.io/",children:"Directus"}),", a headless CMS platform.\nYou'll learn how to generate a type-safe API client that leverages Directus's powerful query parameter system, including filters,\nsorting, field selection, and metadata options, all with full TypeScript type safety."]}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"Directus provides a comprehensive REST API with a sophisticated query parameter system that includes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Filters"}),": Complex filtering with operators like ",(0,i.jsx)(n.code,{children:"_eq"}),", ",(0,i.jsx)(n.code,{children:"_in"}),", ",(0,i.jsx)(n.code,{children:"_null"}),", and many more (see ",(0,i.jsx)(n.a,{href:"https://directus.io/docs/guides/connect/query-parameters#filter",children:"Directus Query Parameters - Filter"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Field selection"}),": Choose which fields to return, including nested relational fields with dot notation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sorting"}),": Sort results by one or more fields, ascending or descending"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pagination"}),": Control results with ",(0,i.jsx)(n.code,{children:"limit"}),", ",(0,i.jsx)(n.code,{children:"offset"}),", and ",(0,i.jsx)(n.code,{children:"page"})," parameters"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metadata"}),": Request additional metadata like ",(0,i.jsx)(n.code,{children:"filter_count"})," or ",(0,i.jsx)(n.code,{children:"total_count"})," for efficient counting"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Search"}),": Full-text search across string and text fields"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Aggregation"}),": Perform calculations with aggregate functions"]}),"\n",(0,i.jsx)(n.li,{children:"And many more advanced features"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The key feature of this integration is that ",(0,i.jsx)(n.strong,{children:"all of these Directus query parameters are fully typed"})," when using the generated API client.\nInstead of working with generic query strings or untyped objects, you get:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Full TypeScript autocomplete for Directus query syntax"}),"\n",(0,i.jsx)(n.li,{children:"Type-safe filter operators and field names"}),"\n",(0,i.jsx)(n.li,{children:"Compile-time validation of query structure"}),"\n",(0,i.jsxs)(n.li,{children:["Seamless integration with Directus SDK's ",(0,i.jsx)(n.code,{children:"Query"})," type"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before starting, ensure you have:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A working Directus instance (local or remote)"}),"\n",(0,i.jsx)(n.li,{children:"OpenAPI specification file from your Directus instance"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"installing-required-packages",children:"Installing Required Packages"}),"\n",(0,i.jsx)(n.p,{children:"Install the necessary packages for code generation and runtime:"}),"\n",(0,i.jsxs)(a.A,{groupId:"npm2yarn",children:[(0,i.jsx)(o.A,{value:"npm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install -D @openapi-qraft/cli\nnpm install @openapi-qraft/react @openapi-qraft/tanstack-query-react-types @directus/sdk\nnpm install @tanstack/react-query\n"})})}),(0,i.jsx)(o.A,{value:"yarn",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn add --dev @openapi-qraft/cli\nyarn add @openapi-qraft/react @openapi-qraft/tanstack-query-react-types @directus/sdk\nyarn add @tanstack/react-query\n"})})}),(0,i.jsx)(o.A,{value:"pnpm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm add -D @openapi-qraft/cli\npnpm add @openapi-qraft/react @openapi-qraft/tanstack-query-react-types @directus/sdk\npnpm add @tanstack/react-query\n"})})})]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["For more details on installation, see the ",(0,i.jsx)(n.a,{href:"/openapi-qraft/docs/getting-started/installation",children:"Installation guide"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"creating-the-configuration",children:"Creating the Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["The recommended approach is to use a Redocly configuration file (",(0,i.jsx)(n.code,{children:"apis.yaml"})," or ",(0,i.jsx)(n.code,{children:"redocly.yaml"}),") to manage\nyour API client generation. This allows you to centralize settings and easily manage multiple APIs."]}),"\n",(0,i.jsx)(n.h3,{id:"configuration-file-structure",children:"Configuration File Structure"}),"\n",(0,i.jsxs)(n.p,{children:["\xa7\nCreate an ",(0,i.jsx)(n.code,{children:"apis.yaml"})," file in your project root (or wherever you prefer to store your configuration):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# OpenAPI Qraft configuration\n# Global plugins configuration\nx-openapi-qraft:\n  plugin:\n    tanstack-query-react: true\n    openapi-typescript: true\n\napis:\n  # Directus API configuration\n  directus:\n    root: src/api/directus/openapi.json\n    x-openapi-qraft:\n      output-dir: src/api/directus\n      clean: true\n      # Filter services to exclude utils endpoints\n      filter-services:\n        - '/**'\n        - '!/utils/**'\n      # Configure custom ParametersWrapper types for specific operations\n      # You can apply these wrappers to any Directus endpoints (items, users, files, etc.)\n      # Patterns don't need to specify HTTP methods - they apply to all methods\n      # If you need to target a specific method, you can use: 'get /items/*' or 'post /items/*'\n      operation-parameters-type-wrapper:\n        # For operations that return arrays (covers first-level paths like /items, /users, etc.)\n        # The '/*,!/fields' pattern means: all first-level paths except /fields\n        '/*,!/fields':\n          type: 'ItemsQueryParametersWrapper'\n          import: './types'\n        # For operations that return a single item (e.g., /items/collection/{id})\n        # The '/*/{id},!/fields/{id}' pattern means: all second-level paths with {id} except /fields/{id}\n        '/*/{id},!/fields/{id}':\n          type: 'SingleItemsQueryParametersWrapper'\n          import: './types'\n        # You can also specify specific endpoints for nested paths if needed\n        '/items/*':\n          type: 'ItemsQueryParametersWrapper'\n          import: './types'\n        '/items/*/{id}':\n          type: 'SingleItemsQueryParametersWrapper'\n          import: './types'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration-options-explained",children:"Configuration Options Explained"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"root"})}),": Path to your Directus OpenAPI specification file"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"output-dir"})}),": Directory where generated files will be placed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"clean"})}),": Automatically clean the output directory before generation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"filter-services"})}),": Glob patterns to include/exclude specific endpoints"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"operation-parameters-type-wrapper"})}),": Configure custom parameter types for specific operations.\nFor Directus integration, this is particularly important for operations that use query parameters\n(like ",(0,i.jsx)(n.code,{children:"/items/*"}),", ",(0,i.jsx)(n.code,{children:"/users"}),", etc.), where Directus's powerful query parameters (filters, sorting, field selection, metadata, etc.)\nneed to be properly typed using Directus SDK's ",(0,i.jsx)(n.code,{children:"Query"})," and ",(0,i.jsx)(n.code,{children:"QueryItem"})," types instead of generic OpenAPI parameter types.\nPatterns don't need to specify HTTP methods - they apply to all methods. You can use negative patterns (e.g., ",(0,i.jsx)(n.code,{children:"'/*,!/fields'"}),")\nto exclude specific endpoints from the wrapper."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["For more information about Redocly configuration options, see the ",(0,i.jsx)(n.a,{href:"/openapi-qraft/docs/codegen/CLI/redocly-config",children:"Redocly config support"})," documentation."]})}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-custom-parameterswrapper-type",children:"Creating a Custom ParametersWrapper Type"}),"\n",(0,i.jsxs)(n.p,{children:["Directus uses a sophisticated query system that requires custom parameter handling. To properly type Directus queries, you'll need to create a custom ",(0,i.jsx)(n.code,{children:"ParametersWrapper"})," type."]}),"\n",(0,i.jsx)(n.h3,{id:"type-definition",children:"Type Definition"}),"\n",(0,i.jsxs)(n.p,{children:["Create a file ",(0,i.jsx)(n.code,{children:"src/api/directus/types.ts"})," with the following content:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { Query, QueryItem } from '@directus/sdk';\n\nimport { components } from './schema';\n\n// For operations that return an array of items (e.g., /items/collection, /users)\nexport type ItemsQueryParametersWrapper<\n  TSchema,\n  TOperation extends { parameters: { query?: any } },\n  TData,\n  TError,\n> = TOperation['parameters'] extends { query?: { fields?: any } }\n  ? TData extends { data?: any[] }\n    ? Merge<\n        TOperation['parameters'],\n        {\n          query?: QueryItems<TData>;\n        }\n      >\n    : TOperation['parameters']\n  : TOperation['parameters'];\n\n// For operations that return a single item (e.g., /items/collection/{id})\nexport type SingleItemsQueryParametersWrapper<\n  TSchema,\n  TOperation extends { parameters: { query?: Record<string, any> } },\n  TData,\n  TError,\n> = TData extends { data?: any }\n  ? NonNullable<TOperation['parameters']['query']> extends {\n      fields?: string[];\n      meta?: string;\n      version?: string;\n    }\n    ? NonNullable<NonNullable<TOperation['parameters']['query']>['version']> extends string\n      ? Merge<\n          TOperation['parameters'],\n          {\n            query?: Pick<QuerySingleItems<TData>, 'fields' | 'meta' | 'version'>;\n          }\n        >\n      : Merge<\n          TOperation['parameters'],\n          {\n            query?: Pick<QuerySingleItems<TData>, 'fields' | 'meta'>;\n          }\n        >\n    : TOperation['parameters']\n  : TOperation['parameters'];\n\ntype Merge<A extends Record<string, any>, B extends Record<string, any>> = Omit<A, keyof B> & B;\n\ntype QuerySingleItems<Item extends { data?: any }> = QueryItem<\n  Schema,\n  NonNullable<Item['data']>\n> & {\n  meta?: Meta;\n};\n\ntype QueryItems<Item extends { data?: any }> = Query<Schema, NonNullable<Item['data']>[number]> & {\n  meta?: Meta;\n};\n\ntype Meta = 'filter_count' | 'total_count';\n\ntype Schema = {\n  [key in keyof components['schemas']]: components['schemas'][key][];\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"understanding-the-types",children:"Understanding the Types"}),"\n",(0,i.jsx)(n.p,{children:"Both wrapper types accept four generic parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"TSchema"})}),": The operation schema containing method and URL information (automatically provided by the code generator)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"TOperation"})}),": The operation type from OpenAPI paths, containing the original parameters definition"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"TData"})}),": The response data type, used to infer the item type for Directus queries"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"TError"})}),": The error type (automatically provided by the code generator)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When to use each type:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"ItemsQueryParametersWrapper"})}),": Use for operations that return an array of items (e.g., ",(0,i.jsx)(n.code,{children:"/items/collection"}),", ",(0,i.jsx)(n.code,{children:"/users"}),"). The type intelligently checks if the operation has query parameters with ",(0,i.jsx)(n.code,{children:"fields"}),", and if the response is an array, it merges the original parameters with Directus ",(0,i.jsx)(n.code,{children:"Query"})," type for proper typing."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"SingleItemsQueryParametersWrapper"})}),": Use for operations that return a single item (e.g., ",(0,i.jsx)(n.code,{children:"/items/collection/{id}"}),"). The type checks for ",(0,i.jsx)(n.code,{children:"fields"}),", ",(0,i.jsx)(n.code,{children:"meta"}),", and ",(0,i.jsx)(n.code,{children:"version"})," parameters and conditionally applies Directus ",(0,i.jsx)(n.code,{children:"QueryItem"})," type with appropriate field selection."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Omit<TOperation['parameters'], 'query'>"})}),": Removes the default ",(0,i.jsx)(n.code,{children:"query"})," parameter from the operation's parameters"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Custom ",(0,i.jsx)(n.code,{children:"query"})," property"]}),": Replaces it with Directus's ",(0,i.jsx)(n.code,{children:"Query"})," type from ",(0,i.jsx)(n.code,{children:"@directus/sdk"}),", which provides:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Type-safe field selection"}),"\n",(0,i.jsx)(n.li,{children:"Filtering capabilities"}),"\n",(0,i.jsx)(n.li,{children:"Sorting options"}),"\n",(0,i.jsx)(n.li,{children:"Pagination controls"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"meta"})," parameter"]}),": Adds support for Directus's metadata options (",(0,i.jsx)(n.code,{children:"filter_count"}),", ",(0,i.jsx)(n.code,{children:"total_count"}),") for efficient counting operations"]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsxs)(n.p,{children:["The generic parameters ",(0,i.jsx)(n.code,{children:"TSchema"}),", ",(0,i.jsx)(n.code,{children:"TData"}),", and ",(0,i.jsx)(n.code,{children:"TError"})," may appear unused in the type body, but they are required\nfor proper type inference and are passed by the code generator. If your linter flags them as unused, you can disable the rule for this file using:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"/* eslint-disable @typescript-eslint/no-unused-vars */\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"generating-the-api-client",children:"Generating the API Client"}),"\n",(0,i.jsx)(n.p,{children:"Once your configuration is set up, you can generate the API client using the Qraft CLI."}),"\n",(0,i.jsx)(n.h3,{id:"using-redocly-configuration",children:"Using Redocly Configuration"}),"\n",(0,i.jsx)(n.p,{children:"The simplest approach is to use the Redocly configuration file:"}),"\n",(0,i.jsxs)(a.A,{groupId:"npm2yarn",children:[(0,i.jsx)(o.A,{value:"npm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx openapi-qraft directus --redocly apis.yaml\n"})})}),(0,i.jsx)(o.A,{value:"yarn",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn exec openapi-qraft directus --redocly apis.yaml\n"})})}),(0,i.jsx)(o.A,{value:"pnpm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm exec openapi-qraft directus --redocly apis.yaml\n"})})})]}),"\n",(0,i.jsx)(n.p,{children:"This command will:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Read the configuration from ",(0,i.jsx)(n.code,{children:"apis.yaml"})]}),"\n",(0,i.jsx)(n.li,{children:"Generate TypeScript types from the OpenAPI specification"}),"\n",(0,i.jsx)(n.li,{children:"Generate React Query hooks for all configured endpoints"}),"\n",(0,i.jsxs)(n.li,{children:["Apply the custom ",(0,i.jsx)(n.code,{children:"ItemsQueryParametersWrapper"})," and ",(0,i.jsx)(n.code,{children:"SingleItemsQueryParametersWrapper"})," types where specified"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"adding-a-script-to-packagejson",children:"Adding a Script to package.json"}),"\n",(0,i.jsxs)(n.p,{children:["For convenience, add a script to your ",(0,i.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "generate-api-client:directus": "openapi-qraft directus --redocly apis.yaml"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Then run:"}),"\n",(0,i.jsxs)(a.A,{groupId:"npm2yarn",children:[(0,i.jsx)(o.A,{value:"npm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run generate-api-client:directus\n"})})}),(0,i.jsx)(o.A,{value:"yarn",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn generate-api-client:directus\n"})})}),(0,i.jsx)(o.A,{value:"pnpm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm run generate-api-client:directus\n"})})})]}),"\n",(0,i.jsx)(n.h3,{id:"alternative-using-cli-options-directly",children:"Alternative: Using CLI Options Directly"}),"\n",(0,i.jsx)(n.p,{children:"If you prefer not to use a configuration file, you can specify options directly:"}),"\n",(0,i.jsxs)(a.A,{groupId:"npm2yarn",children:[(0,i.jsx)(o.A,{value:"npm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx openapi-qraft \\\n  --plugin tanstack-query-react \\\n  --plugin openapi-typescript \\\n  --output-dir src/api/directus \\\n  --clean \\\n  --filter-services '/**' '!/utils/**' \\\n  --operation-parameters-type-wrapper '/*,!/fields' 'type:ItemsQueryParametersWrapper' 'import:./types' \\\n  --operation-parameters-type-wrapper '/*/{id},!/fields/{id}' 'type:SingleItemsQueryParametersWrapper' 'import:./types' \\\n  ./src/api/directus/openapi.json\n"})})}),(0,i.jsx)(o.A,{value:"yarn",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn exec openapi-qraft \\\n  --plugin tanstack-query-react \\\n  --plugin openapi-typescript \\\n  --output-dir src/api/directus \\\n  --clean \\\n  --filter-services '/**' '!/utils/**' \\\n  --operation-parameters-type-wrapper '/*,!/fields' 'type:ItemsQueryParametersWrapper' 'import:./types' \\\n  --operation-parameters-type-wrapper '/*/{id},!/fields/{id}' 'type:SingleItemsQueryParametersWrapper' 'import:./types' \\\n  ./src/api/directus/openapi.json\n"})})}),(0,i.jsx)(o.A,{value:"pnpm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm exec openapi-qraft \\\n  --plugin tanstack-query-react \\\n  --plugin openapi-typescript \\\n  --output-dir src/api/directus \\\n  --clean \\\n  --filter-services '/**' '!/utils/**' \\\n  --operation-parameters-type-wrapper '/*,!/fields' 'type:ItemsQueryParametersWrapper' 'import:./types' \\\n  --operation-parameters-type-wrapper '/*/{id},!/fields/{id}' 'type:SingleItemsQueryParametersWrapper' 'import:./types' \\\n  ./src/api/directus/openapi.json\n"})})})]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["For a complete list of CLI options, see the ",(0,i.jsx)(n.a,{href:"/openapi-qraft/docs/codegen/CLI/",children:"CLI documentation"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-custom-requestfn-for-directus",children:"Creating a Custom requestFn for Directus"}),"\n",(0,i.jsxs)(n.p,{children:["While OpenAPI Qraft provides a default ",(0,i.jsx)(n.code,{children:"requestFn"})," that works with most APIs,\nDirectus has built-in functionality in its SDK for correctly processing complex query parameters.\nThe Directus SDK handles sophisticated query parameters (filters, field selection, etc.)\nreliably through its REST transport, ensuring proper encoding and processing of all Directus-specific query syntax."]}),"\n",(0,i.jsxs)(n.p,{children:["To properly integrate Directus with OpenAPI Qraft, you'll need to create a custom ",(0,i.jsx)(n.code,{children:"requestFn"})," that:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Uses Directus SDK's REST client to handle query parameters correctly"}),"\n",(0,i.jsx)(n.li,{children:"Intercepts the raw HTTP response to allow Qraft to process it"}),"\n",(0,i.jsx)(n.li,{children:"Maintains compatibility with Qraft's response handling and error processing"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-the-requestfn-file",children:"Creating the requestFn File"}),"\n",(0,i.jsxs)(n.p,{children:["Create a file ",(0,i.jsx)(n.code,{children:"src/api/directus/requestFn.ts"})," with the following implementation:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import type { HttpMethod } from '@directus/sdk';\nimport type { OperationSchema, RequestFnInfo, RequestFnResponse } from '@openapi-qraft/react';\nimport { rest } from '@directus/sdk';\nimport { bodySerializer, mergeHeaders, urlSerializer } from '@openapi-qraft/react';\nimport { processResponse, resolveResponse } from '@openapi-qraft/react/unstable__responseUtils';\n\nexport function directusRequestFn<TData, TError>(\n  requestSchema: OperationSchema,\n  requestInfo: RequestFnInfo\n): Promise<RequestFnResponse<TData, TError>> {\n  // Build the URL path (e.g., /items/artworks/{id}) with path parameters substituted\n  // baseUrl is empty here because it will be used when creating the Directus client below\n  // query parameters are undefined because we only need the path here; query params will be handled by Directus SDK separately\n  const path = urlSerializer(requestSchema, {\n    ...requestInfo,\n    baseUrl: '', // Will be used when creating the Directus client\n    parameters: { ...requestInfo.parameters, query: undefined }, // Only path parameters, query handled separately\n  });\n\n  let response: Response;\n\n  /**\n   * Custom fetch wrapper that intercepts the actual response.\n   *\n   * The Directus REST client requires fetch to return a Response object, but if we return\n   * the actual response, Directus SDK will attempt to parse it using its internal mechanism.\n   * To avoid this and let Qraft handle response processing instead, we:\n   * 1. Store the real response in the local `response` variable\n   * 2. Return an empty Response object to satisfy Directus SDK requirements\n   *\n   * The actual response is then used later via `processResponse(response)` and\n   * `resolveResponse` for proper error handling using Qraft's internal utilities.\n   */\n  const fetch = (input: RequestInfo | URL, init?: RequestInit): Promise<Response> => {\n    return globalThis.fetch(input, {\n        ...init,\n        // Include cookies in requests for Directus cookie-based authentication\n        // This ensures that authentication cookies are sent with each request\n        credentials: 'include'\n      }).then(fetchResponse => {\n      response = fetchResponse;\n      return new Response();\n    });\n  };\n\n  // Initialize Directus REST client with custom fetch wrapper\n  const client = rest()({\n    url: new URL(requestInfo.baseUrl ?? ''),\n    with(createExtension) {\n      return {\n        ...this,\n        ...createExtension(this),\n      };\n    },\n    globals: {\n      fetch,\n      WebSocket: globalThis.WebSocket,\n      URL: globalThis.URL,\n      logger: globalThis.console,\n    },\n  });\n\n  // Serialize request body if present\n  const bodyInfo = requestInfo.body ? bodySerializer(requestSchema, requestInfo.body) : undefined;\n\n  // Merge headers from parameters, body, and request info\n  const headers = mergeHeaders(\n    requestInfo.parameters?.header,\n    bodyInfo?.headers,\n    requestInfo.headers\n  );\n\n  // Execute the request through Directus SDK\n  return (\n    client\n      .request(() => ({\n        path,\n        method: requestSchema.method.toUpperCase() as HttpMethod,\n        // Pass query parameters to Directus SDK for proper processing\n        params: requestInfo.parameters?.query,\n        headers: Object.fromEntries(headers),\n        body: bodyInfo?.body as FormData,\n      }))\n      // The result from client.request() is ignored because Directus SDK has already\n      // processed the JSON internally. We use the intercepted raw response instead\n      // and process it ourselves using Qraft's processResponse utility.\n      .then(() => processResponse<TData, TError>(response))\n      .catch(resolveResponse as typeof resolveResponse<TData, TError>)\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"why-this-is-necessary",children:"Why This Is Necessary"}),"\n",(0,i.jsx)(n.p,{children:"Directus uses a sophisticated query parameter system that includes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Complex filter syntax (e.g., ",(0,i.jsx)(n.code,{children:"filter[field][_eq]=value"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Nested relational queries"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The Directus SDK's REST client knows how to properly encode these parameters,\nbut the standard ",(0,i.jsx)(n.code,{children:"requestFn"})," from OpenAPI Qraft would treat them as simple URL query strings,\nwhich could lead to incorrect encoding or missing functionality."]}),"\n",(0,i.jsx)(n.h2,{id:"using-the-generated-client-in-react",children:"Using the Generated Client in React"}),"\n",(0,i.jsx)(n.p,{children:"After generation, you can use the generated API client in your React application. Here's a complete example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",metastring:'title="src/components/FavoritesCount.tsx"',children:"import { createAPIClient } from '../api/directus';\nimport { directusRequestFn } from '../api/directus/requestFn';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { useState } from 'react';\n\nconst queryClient = new QueryClient();\n\n// Initialize the API client with custom Directus requestFn\nconst api = createAPIClient({\n  requestFn: directusRequestFn,\n  queryClient,\n  baseUrl: 'https://your-directus-instance.com',\n});\n\nfunction FavoritesCount({ isAuthenticated }: { isAuthenticated: boolean }) {\n  const { data: count, isPending, error } = api.items.readItemsFavorites.useQuery(\n    {\n      query: {\n        limit: 0,\n        meta: 'filter_count',\n        fields: ['*', { picture: [{ file: ['*'] }] }],\n        filter: {\n          artwork: {\n            _nnull: true,\n          },\n        },\n      },\n    },\n    {\n      select: (data) => data?.meta?.filter_count ?? 0,\n      enabled: Boolean(isAuthenticated),\n    }\n  );\n\n  if (isPending) return <div>Loading...</div>;\n  if (error) return <div>Error: {error.message}</div>;\n\n  return <div>Favorites count: {count}</div>;\n}\n\nexport default function App() {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <button onClick={() => setIsAuthenticated(!isAuthenticated)}>\n        Toggle Auth\n      </button>\n      <FavoritesCount isAuthenticated={isAuthenticated} />\n    </QueryClientProvider>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"key-features-demonstrated",children:"Key Features Demonstrated"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type-safe Directus queries"}),": The ",(0,i.jsx)(n.code,{children:"query"})," parameter is fully typed with Directus's query syntax"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metadata support"}),": Using ",(0,i.jsx)(n.code,{children:"meta: 'filter_count'"})," to get efficient count results"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data transformation"}),": Using ",(0,i.jsx)(n.code,{children:"select"})," to extract the count from the response"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Conditional fetching"}),": Using ",(0,i.jsx)(n.code,{children:"enabled"})," to control when the query executes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Error handling"}),": Proper handling of loading and error states"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"additional-configuration",children:"Additional Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"obtaining-the-openapi-specification",children:"Obtaining the OpenAPI Specification"}),"\n",(0,i.jsx)(n.p,{children:"To get the OpenAPI specification from your Directus instance, you can use a script:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "download-api-client:directus": "curl --fail --silent --show-error -o ./src/api/directus/openapi.json \'http://localhost:8055/server/specs/oas?access_token=admin\' && prettier --write ./src/api/directus/openapi.json"\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Replace ",(0,i.jsx)(n.code,{children:"http://localhost:8055"})," with your Directus instance URL and adjust the access token as needed."]}),"\n",(0,i.jsx)(n.h3,{id:"multiple-apis",children:"Multiple APIs"}),"\n",(0,i.jsxs)(n.p,{children:["If you're managing multiple APIs (e.g., Directus, Hono, and others), you can configure them all in the same ",(0,i.jsx)(n.code,{children:"apis.yaml"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"x-openapi-qraft:\n  plugin:\n    tanstack-query-react: true\n    openapi-typescript: true\n\napis:\n  directus:\n    root: src/api/directus/openapi.json\n    x-openapi-qraft:\n      output-dir: src/api/directus\n      # ... Directus-specific configuration\n\n  hono:\n    root: ./src/hono/openapi.json\n    x-openapi-qraft:\n      output-dir: src/hono\n      # ... Hono-specific configuration\n"})}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Learn more about ",(0,i.jsx)(n.a,{href:"/openapi-qraft/docs/codegen/CLI/redocly-config",children:"Redocly configuration"})]}),"\n",(0,i.jsxs)(n.li,{children:["Explore ",(0,i.jsx)(n.a,{href:"/openapi-qraft/docs/codegen/CLI/",children:"CLI options"})," for advanced customization, including the ",(0,i.jsx)(n.code,{children:"--operation-parameters-type-wrapper"})," option"]}),"\n",(0,i.jsxs)(n.li,{children:["Check out the ",(0,i.jsx)(n.a,{href:"/openapi-qraft/docs/getting-started/quick-start",children:"Quick Start guide"})," for general usage patterns"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},2491:(e,n,r)=>{r.d(n,{A:()=>a});r(3696);var t=r(1750);const i={tabItem:"tabItem_wHwb"};var s=r(2540);function a({children:e,hidden:n,className:r}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(i.tabItem,r),hidden:n,children:e})}},3023:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var t=r(3696);const i={},s=t.createContext(i);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}},8296:(e,n,r)=>{r.d(n,{A:()=>I});var t=r(3696),i=r(1750),s=r(3237),a=r(766),o=r(9519),l=r(4395),c=r(5043),d=r(4544),p=r(4243);function u(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:r}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:r,default:t}})=>({value:e,label:n,attributes:r,default:t}))}(r);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,r])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function f({queryString:e=!1,groupId:n}){const r=(0,o.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(i),(0,t.useCallback)(e=>{if(!i)return;const n=new URLSearchParams(r.location.search);n.set(i,e),r.replace({...r.location,search:n.toString()})},[i,r])]}function g(e){const{defaultValue:n,queryString:r=!1,groupId:i}=e,s=h(e),[a,o]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=n.find(e=>e.default)??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:s})),[c,d]=f({queryString:r,groupId:i}),[u,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,i]=(0,p.Dv)(n);return[r,(0,t.useCallback)(e=>{n&&i.set(e)},[n,i])]}({groupId:i}),y=(()=>{const e=c??u;return m({value:e,tabValues:s})?e:null})();(0,l.A)(()=>{y&&o(y)},[y]);return{selectedValue:a,selectValue:(0,t.useCallback)(e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),g(e)},[d,g,s]),tabValues:s}}var y=r(6681);const x={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var j=r(2540);function q({className:e,block:n,selectedValue:r,selectValue:t,tabValues:s}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),c=e=>{const n=e.currentTarget,i=o.indexOf(n),a=s[i].value;a!==r&&(l(n),t(a))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=o.indexOf(e.currentTarget)+1;n=o[r]??o[0];break}case"ArrowLeft":{const r=o.indexOf(e.currentTarget)-1;n=o[r]??o[o.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:s.map(({value:e,label:n,attributes:t})=>(0,j.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:c,...t,className:(0,i.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":r===e}),children:n??e},e))})}function v({lazy:e,children:n,selectedValue:r}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===r);return e?(0,t.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==r}))})}function b(e){const n=g(e);return(0,j.jsxs)("div",{className:(0,i.A)(s.G.tabs.container,"tabs-container",x.tabList),children:[(0,j.jsx)(q,{...n,...e}),(0,j.jsx)(v,{...n,...e})]})}function I(e){const n=(0,y.A)();return(0,j.jsx)(b,{...e,children:u(e.children)},String(n))}}}]);